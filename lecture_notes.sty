% notes.sty
\ProvidesPackage{lecture_notes}[2025/09/13 Lecture Notes Style]

%%%%%%%% PACKAGES %%%%%%%%
\RequirePackage{amsmath,amssymb,amsthm,mathtools,amsfonts}
\RequirePackage{bm,bbm}
\RequirePackage[usenames,dvipsnames,svgnames]{xcolor}
\RequirePackage[framemethod=TikZ]{mdframed}
\RequirePackage{thmtools}
\RequirePackage{tikz}
\usetikzlibrary{automata,positioning,arrows,calc}
\RequirePackage{algorithm}
\RequirePackage[noend]{algpseudocode}
\RequirePackage{hyperref}
\RequirePackage[shortlabels]{enumitem}
\RequirePackage{caption}
\RequirePackage{sectsty}

%%%%%%%%% If/Else Toggles %%%%%%%%%
\newif\ifnotesheader\notesheaderfalse      % default: no header
\newif\ifnotesmargin\notesmarginfalse      % default: no margin override
\newif\ifnotessans\notessansfalse          % default: serif font
\newif\ifnotestitlepage\notestitlepagefalse% default: no custom title page
\newif\ifnotesbib\notesbibfalse            % default: no bibliography

%%%%%%%  Receive Options %%%%%%%%
\DeclareOption{header}{\notesheadertrue}
\DeclareOption{noheader}{\notesheaderfalse}
\DeclareOption{margin}{\notesmargintrue}
\DeclareOption{nomargin}{\notesmarginfalse}
\DeclareOption{sans}{\notessanstrue}
\DeclareOption{serif}{\notessansfalse}
\DeclareOption{titlepage}{\notestitlepagetrue}
\DeclareOption{notitlepage}{\notestitlepagefalse}
\DeclareOption{bib}{\notesbibtrue}
\DeclareOption{nobib}{\notesbibfalse}
\ProcessOptions

%%%%%%%% Conditional Imports %%%%%%%%
\ifnotesbib
  \RequirePackage{biblatex}
\fi

%%%%%%%% Font %%%%%%%%
\ifnotessans
  \renewcommand{\familydefault}{\sfdefault}
\fi

%%%%%%%% METADATA %%%%%%%%
% Reuse built-in fields: \title, \author, \date
% Add our own: \lecturer, \semester

\def\@lecturer{}
\def\@semester{}
\newcommand{\lecturer}[1]{\def\@lecturer{#1}}
\newcommand{\semester}[1]{\def\@semester{#1}}

%%%%%%%% Page Setup %%%%%%%%
\ifnotesmargin
  \RequirePackage{geometry}
  \geometry{left=1in,right=1in,top=1in,bottom=1in}

  % Also set paras to start on a new line for readability.
  \setlength{\parindent}{0pt}
  \setlength{\parskip}{1ex plus 0.5ex minus 0.5ex}

  \setcounter{tocdepth}{2}
\fi

\ifnotesheader
  \RequirePackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhf{}
  \fancyhead[L]{\small\@title}
  \fancyhead[R]{\small\@author}
  \cfoot{\thepage}
\fi

\setlist{nosep}
\allsectionsfont{\sffamily\bfseries}

%%%%%%%% TITLE PAGE AND TABLE OF CONTENTS %%%%%%%%
\ifnotestitlepage
  \renewcommand{\maketitle}{%
    \thispagestyle{empty} % no headers/footers
    \begin{center}
      \vspace*{2cm}
      {\LARGE\bfseries \@title \par}   % course name/number
      \vspace{1cm}
      {\large Lecturer(s): \@lecturer \par}
      \vspace{0.5cm}
      {\large Author: \@author \par}
      \vspace{0.5cm}
      {\large Semester: \@semester \par}
  	\vspace{0.5cm}
      {\small \textit{Last edited:} \@date}
      \vfill
      \rule{\textwidth}{0.4pt}\par
      \smallskip
      {\small These notes have been prepared by a student and may contain errors or omissions. They are provided for study purposes only and should not be considered an official record of the course.}    
    \end{center}
    \newpage
    \thispagestyle{empty}
    \tableofcontents
    \newpage
  }
\fi

%%%%%%%% ROOT THEOREM USING MACRO %%%%%%%%
\newcommand{\newscribebox}[3]{%
  \mdfdefinestyle{#1box}{%
    linewidth=3pt,
    linecolor=#3,
    topline=false, bottomline=false, rightline=false, % only left stripe
    backgroundcolor=#3!10,
    skipabove=10pt, skipbelow=10pt,
    innertopmargin=8pt, innerbottommargin=8pt,
    innerleftmargin=10pt, innerrightmargin=10pt
  }
  \declaretheoremstyle[
    headfont=\bfseries\sffamily\color{black},
    bodyfont=\normalfont,
    mdframed={style=#1box},
    headpunct={.},
    postheadspace={0.5em}
  ]{#1style}
  \declaretheorem[style=#1style,numberwithin=section,name=#2]{#1}
}

%%%%%%%% ENVIRONMENTS %%%%%%%%
\newscribebox{theorem}{Theorem}{Blue}
\newscribebox{lemma}{Lemma}{Teal}
\newscribebox{proposition}{Proposition}{Brown}
\newscribebox{corollary}{Corollary}{OliveGreen}
\newscribebox{definition}{Definition}{ForestGreen}
\newscribebox{example}{Example}{Orange}
\newscribebox{exercise}{Exercise}{BrickRed}
\newscribebox{note}{Note}{Purple}

%%%%%%%% PROOF ENVIRONMENTS %%%%%%%%
\newenvironment{proofsketch}{\begin{proof}[Proof Sketch]}{\end{proof}}

%%%%%%%% LISTS %%%%%%%%
\setlist{nosep} % compact itemize/enumerate by default

%%%%%%%% MATH SHORTCUTS %%%%%%%%
% Sets
\newcommand{\RR}{\mathbb{R}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\EE}{\mathbb{E}}
\newcommand{\FF}{\mathit{F}}

% Probability distributions
\newcommand{\Ber}{\operatorname{Ber}}
\newcommand{\Bin}{\operatorname{Bin}}
\newcommand{\Geo}{\operatorname{Geo}}
\newcommand{\Pois}{\operatorname{Poisson}}
\newcommand{\Nor}{\mathcal{N}}
\newcommand{\BetaDist}{\operatorname{Beta}}
\newcommand{\GammaDist}{\operatorname{Gamma}}
\newcommand{\Dir}{\operatorname{Dir}}        % Dirichlet
\newcommand{\DistDelta}{\operatorname{Delta}} % Point mass
\newcommand{\Unif}{\operatorname{Unif}}      % Uniform
\newcommand{\Exp}{\operatorname{Exp}}        % Exponential
\newcommand{\ChiSq}{\chi^2}                  % Chi-square
\newcommand{\Lap}{\operatorname{Lap}}        % Laplace
\newcommand{\StudentT}{t}                    % Student's t
\newcommand{\Cauchy}{\operatorname{Cauchy}}
\newcommand{\Wishart}{\operatorname{Wishart}}

% Moments & operators
\newcommand{\Var}{\operatorname{Var}}
\newcommand{\Cov}{\operatorname{Cov}}
\newcommand{\Corr}{\operatorname{Corr}}

% Optimization operators
\newcommand{\argmax}{\operatorname*{arg\,max}}
\newcommand{\argmin}{\operatorname*{arg\,min}}
\newcommand{\maximize}{\operatorname*{maximize}}
\newcommand{\minimize}{\operatorname*{minimize}}
\newcommand{\supremum}{\operatorname*{sup}}
\newcommand{\infimum}{\operatorname*{inf}}
\newcommand{\limsupm}{\operatorname*{lim\,sup}}
\newcommand{\liminfm}{\operatorname*{lim\,inf}}
\newcommand{\loss}{\operatorname*{loss}}

% Vectors and matrices
\newcommand{\vx}{\bm{x}}
\newcommand{\vy}{\bm{y}}
\newcommand{\vv}{\bm{v}}
\newcommand{\vb}{\bm{b}}
\newcommand{\mA}{\bm{A}}
\newcommand{\mI}{\mathbf{I}}

% More linear algebra
% Linear algebra operators
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\Null}{Null}

% Norms and abs
\newcommand{\abs}[1]{\lvert #1 \rvert}
\newcommand{\norm}[1]{\lVert #1 \rVert}
\newcommand{\ceil}[1]{\lceil #1 \rceil}
\newcommand{\floor}[1]{\lfloor #1 \rfloor}
\newcommand{\indicator}[1]{\mathbbm{1}\{#1\}}

% Probability & conditionals
\newcommand{\given}{\;\middle|\;}
\newcommand{\Econd}[2]{\EE\left[#1 \,\middle|\, #2\right]}
\newcommand{\Pcond}[2]{P\left(#1 \,\middle|\, #2\right)}
\newcommand{\p}[1]{p\!\left(#1\right)}
\newcommand{\q}[1]{q\!\left(#1\right)}
\newcommand{\indep}{\perp \!\!\! \perp}

% Gaussian processes & kernels
\newcommand{\GP}[2]{\mathcal{GP}\!\left(#1, #2\right)}
\newcommand{\Kmat}{\mathbf{K}}
\newcommand{\kvec}{\mathbf{k}}
\newcommand{\kx}[1]{k\!\left(#1\right)}
\newcommand{\kxx}[2]{k\!\left(#1,#2\right)}

% Linear algebra helpers
\newcommand{\T}{^{\mathsf{T}}}
\newcommand{\inv}{^{-1}}
\newcommand{\half}{\tfrac{1}{2}}
\newcommand{\diag}{\operatorname{diag}}

%%%%%%%% DANGER/WARNING ENVIRONMENTS %%%%%%%%
\font\manual=manfnt
\def\dbend{{\manual\char127}} % dangerous bend symbol
\newenvironment{danger}{\begin{trivlist}\item[]\noindent%
\begingroup\hangindent=2pc\hangafter=-2%
\hbox to0pt{\hskip-\hangindent\dbend\hfill}\ignorespaces}{\endgroup\end{trivlist}}
\newenvironment{ddanger}{\begin{trivlist}\item[]\noindent%
\begingroup\hangindent=3.5pc\hangafter=-2%
\hbox to0pt{\hskip-\hangindent\dbend\kern2pt\dbend\hfill}\ignorespaces}{\endgroup\end{trivlist}}

%%%%%%%% DRAFTING / NOTES %%%%%%%%
\newcommand{\draftnote}[1]{\textcolor{red}{\textsf{<<#1>>}}}
\newcommand{\sidenote}[1]{\marginpar{\tiny\textsf{#1}}}
\newcommand{\DRAFT}{%
  \begin{center}
    \fbox{\textsf{\textbf{DRAFT --- \today}}}
  \end{center}
}

%%%%%%%% CRYPTOGRAPHY MACROS %%%%%%%%
% Algorithms / primitives
\newcommand{\Gen}{\mathsf{Gen}}
\newcommand{\KeyGen}{\mathsf{KeyGen}}
\newcommand{\Enc}{\mathsf{Enc}}
\newcommand{\Dec}{\mathsf{Dec}}
\newcommand{\Sign}{\mathsf{Sign}}
\newcommand{\Vrfy}{\mathsf{Vrfy}}
\newcommand{\Mac}{\mathsf{Mac}}
\newcommand{\VrfyMac}{\mathsf{VrfyMac}}
\newcommand{\Com}{\mathsf{Com}}
\newcommand{\Open}{\mathsf{Open}}

% Security notions
\newcommand{\INDCPA}{\mathsf{IND\text{-}CPA}}
\newcommand{\INDCCA}{\mathsf{IND\text{-}CCA}}
\newcommand{\PRF}{\mathsf{PRF}}
\newcommand{\PRP}{\mathsf{PRP}}
\newcommand{\EUFCMA}{\mathsf{EUF\text{-}CMA}}

% Advantage / negligible
\newcommand{\Adv}[2]{\mathsf{Adv}^{#1}_{#2}}
\newcommand{\negl}{\mathsf{negl}}

% Sets of keys, messages, ciphertexts
\newcommand{\Keys}{\mathcal{K}}
\newcommand{\Msgs}{\mathcal{M}}
\newcommand{\Ciphers}{\mathcal{C}}

%%%%%%%% PROTOCOL DIAGRAMS %%%%%%%%
\usetikzlibrary{arrows.meta,shapes.multipart}

\tikzset{
  role/.style={rectangle, draw, minimum width=2.5cm, minimum height=0.9cm, font=\sffamily, align=center},
  msg/.style={-{Latex[length=2mm]}, thick}
}

\newenvironment{protocol}[1][]{
  \begin{tikzpicture}[#1, node distance=2cm]
}{
  \end{tikzpicture}
}

% Inline monospace
\newcommand{\code}[1]{\texttt{#1}}

%%%%%%%% CRYPTO MATH OPERATORS %%%%%%%%
\DeclareMathOperator{\poly}{poly}
\DeclareMathOperator{\polylog}{polylog}
\DeclareMathOperator{\Time}{Time}
\DeclareMathOperator{\Prob}{Pr}
\DeclareMathOperator{\Supp}{Supp}


%%%%%%%% HYPERREF FIXES %%%%%%%%
\makeatletter
\def\theoremautorefname{Theorem}
\def\lemmaautorefname{Lemma}
\def\propositionautorefname{Proposition}
\def\corollaryautorefname{Corollary}
\def\definitionautorefname{Definition}
\def\exampleautorefname{Example}
\def\exerciseautorefname{Exercise}
\def\noteautorefname{Note}
\makeatother